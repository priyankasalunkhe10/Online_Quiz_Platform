<!DOCTYPE html>
<html>
<head>
    <title>{{ quiz.title }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-4">
    <h2>{{ quiz.title }}</h2>
    <p>{{ quiz.description }}</p>

    <!-- Pass quiz duration safely via data attribute -->
    <div id="quiz-data" data-duration="{{ quiz.duration }}"></div>

    <div class="alert alert-info">
        Time Left: <span id="timer"></span>
    </div>

    <div class="progress mb-3">
        <div id="progressBar" class="progress-bar progress-bar-striped bg-success" style="width:0%"></div>
    </div>

    <form method="post" id="quizForm">
        {% csrf_token %}
        {% for question in questions %}
            <div class="mb-3">
                <strong>Q{{ forloop.counter }}. {{ question.text }}</strong><br>
                {% for option in question.options.all %}
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="{{ question.id }}" value="{{ option.id }}">
                        <label class="form-check-label">{{ option.text }}</label>
                    </div>
                {% endfor %}
            </div>
        {% endfor %}
        <button class="btn btn-primary">Submit</button>
    </form>

    <script>
        // Get quiz duration from data attribute
        let quizData = document.getElementById("quiz-data");
        let totalSeconds = parseInt(quizData.dataset.duration) * 60;

        function startTimer() {
            let timer = setInterval(function () {
                let minutes = Math.floor(totalSeconds / 60);
                let seconds = totalSeconds % 60;
                document.getElementById("timer").innerHTML = minutes + ":" + (seconds < 10 ? "0" : "") + seconds;

                let progress = ((quizData.dataset.duration * 60 - totalSeconds) / (quizData.dataset.duration * 60)) * 100;
                document.getElementById("progressBar").style.width = progress + "%";

                if (totalSeconds <= 0) {
                    clearInterval(timer);
                    document.getElementById("quizForm").submit(); // Auto-submit
                }
                totalSeconds--;
            }, 1000);
        }

        window.onload = startTimer;
    </script>
</body>
</html>
